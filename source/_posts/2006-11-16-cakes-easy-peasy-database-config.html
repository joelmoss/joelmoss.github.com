--- 
wordpress_id: 84
layout: post
title: Cake's easy-peasy database config
wordpress_url: http://developingwithstyle.com/2006/11/16/cakes-easy-peasy-database-config/
categories: articles
---
Like a lot of developers out there, I use Subversion to keep control of my code and projects, and I also use a different database for development and production. But when using Cake this can be a problem when checking out my code from development to production. Unless I edit my database.php with my production config, the production code would have problems, as it would be trying to access data from the development database.

What I needed was an easy-peasy way of being able to check in my code to production without having to edit the <em>app/config/database.php</em> config file. So what I did was very simple and can be found below:
<pre><code>class DATABASE_CONFIG {

    var $development = array(
        'driver' =&gt; 'mysql',
        'connect' =&gt; 'mysql_connect',
        'host' =&gt; 'localhost',
        'login' =&gt; 'user',
        'password' =&gt; 'passwd',
        'database' =&gt; 'app_devel'
    );
    var $production = array(
        'driver' =&gt; 'mysql',
        'connect' =&gt; 'mysql_connect',
        'host' =&gt; 'localhost',
        'login' =&gt; 'user',
        'password' =&gt; 'passwd',
        'database' =&gt; 'app'
    );
    var $test = array(
        'driver' =&gt; 'mysql',
        'connect' =&gt; 'mysql_connect',
        'host' =&gt; 'localhost',
        'login' =&gt; 'user',
        'password' =&gt; 'passwd',
        'database' =&gt; 'app_test'
    );
    var $default = array();

    function __construct()
    {
        $this-&gt;default = ($_SERVER['SERVER_ADDR'] == '127.0.0.1') ?
            $this-&gt;development : $this-&gt;production;
    }
    function DATABASE_CONFIG()
    {
        $this-&gt;__construct();
    }
}
</code></pre>
What you have here are three arrays for each datasource: development, production and test.  Each one defines the database connection variables for each environment. Nothing special there. Directly underneath that is the <em>$default</em> array, but it is empty. So all we have to do is fill that with the appropriate datasource.

So we set the <em>construct</em> method for the <em>DATABASE_CONFIG</em> class and include simply one line of code. What this code does is to set the <em>$default</em> datasource to the development datasource if the <em>SERVER_ADDR</em> is a local IP. As most of us develop the code on our local machines and then push it to a production server, this will do nicely, as the <em>SERVER_ADDR</em> on your production server will not be a local one.

So now I don't have to edit anything when moving my code to production.

Easy-peasy lemon squeasy ;)
