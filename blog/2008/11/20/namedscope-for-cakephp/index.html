
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Develop With Style: NamedScope for CakePHP</title>
  <meta name="author" content="Joel Moss">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://developwithstyle.com/blog/2008/11/20/namedscope-for-cakephp/"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Develop With Style" type="application/atom+xml"/>
  

  

  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/">Develop With Style</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:developwithstyle.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry">
  
  <header>
    
      <h1 class="entry-title">NamedScope for CakePHP</h1>
    
    
      <p class="meta">




<time datetime="2008-11-20 00:00:00 +0000" pubdate  updated >Nov 20<span>th</span>, 2008</time>


</p>
    
  </header>


<div class="entry-content"><p>I discovered the joys of NamedScope for Ruby on Rails quite a while ago now, and have always been an admirer. Its makes performing finds on models very elegant and convenient, by automagically creating model methods based on your pased scope params. Just like this:</p>




<div><figure role=code><figcaption><span>ruby </span></figcaption>
<div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
<span class='line'>7</span>
<span class='line'>8</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>class User &lt; ActiveRecord::Base
</div><div class='line'>  named_scope :active, :conditions => {:active => true}
</div><div class='line'>  named_scope :inactive, :conditions => {:active => false}
</div><div class='line'>end
</div><div class='line'>
</div><div class='line'># Standard usage
</div><div class='line'>User.active    # same as User.find(:all, :conditions => {:active => true})
</div><div class='line'>User.inactive # same as User.find(:all, :conditions => {:active => false})</div></code></pre></td></tr></table></div></figure></div>




<p>Then a few months ago I read <a href="http://codetunes.com/2008/09/05/named-scope-in-cakephp/">this blog post</a> and discovered that someone had created similar functionality for CakePHP, in the form of a model behavior. Although it&#8217;s not quite as powerful as it&#8217;s Rails cousin, it does let you define named scopes for any model quite easily. However, I wasn&#8217;t crazy about a few things.</p>




<p>Named Scopes are defined like this:</p>




<div><figure role=code><figcaption><span>php </span></figcaption>
<div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
<span class='line'>7</span>
<span class='line'>8</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>class User extends AppModel {
</div><div class='line'>  var $actsAs = array(
</div><div class='line'>    'NamedScope' => array(
</div><div class='line'>      'activated' => array('User.activated in not null'),
</div><div class='line'>      'online' => array('date_add(User.last_activity, interval 5 minute) > now()')
</div><div class='line'>    )
</div><div class='line'>  );
</div><div class='line'>}</div></code></pre></td></tr></table></div></figure></div>




<p>The above format means we can only pass find conditions to a named scope, and cannot pass any other params, such as ORDER and FIELDS.</p>




<p>Then a named scope is then called like this:</p>




<div><figure role=code><figcaption><span>php </span></figcaption>
<div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>$this->User->find('all', array('scope' => 'activated'));
</div><div class='line'>$this->User->find('all',
</div><div class='line'>  array('conditions' => 'points > 10', 'scope' => array('activated', 'online')))</div></code></pre></td></tr></table></div></figure></div>




<p>I have to pass enough params to a find call as it is, so I don&#8217;t want anymore.</p>




<p>What I want to do is this:</p>




<div><figure role=code><figcaption><span>php </span></figcaption>
<div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
<span class='line'>7</span>
<span class='line'>8</span>
<span class='line'>9</span>
<span class='line'>10</span>
<span class='line'>11</span>
<span class='line'>12</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>class User extends AppModel {
</div><div class='line'>  var $actsAs = array(
</div><div class='line'>    'NamedScope' => array(
</div><div class='line'>      'active' => array(
</div><div class='line'>        'conditions' => array(
</div><div class='line'>          'User.is_active' => true
</div><div class='line'>        ),
</div><div class='line'>        'order' => 'User.name ASC'
</div><div class='line'>      )
</div><div class='line'>    )
</div><div class='line'>  );
</div><div class='line'>};</div></code></pre></td></tr></table></div></figure></div>




<p>and this</p>




<div><figure role=code><figcaption><span>php </span></figcaption>
<div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>$active_users = $this->User->active('all');</div></code></pre></td></tr></table></div></figure></div>




<p>I can even do this:</p>




<div><figure role=code><figcaption><span>php </span></figcaption>
<div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>$active_users = $this->User->active('all', array(
</div><div class='line'>    'conditions' => array(
</div><div class='line'>        'User.created' => '2008-01-01'
</div><div class='line'>    ),
</div><div class='line'>    'order' => 'User.name ASC'
</div><div class='line'>));</div></code></pre></td></tr></table></div></figure></div>




<p>Much improved I think, and so much more powerful. <a href="http://codaset.com/joelmoss/cakephp-named-scope">So I&#8217;ve only gone and coded the damn thing</a>! You can find my version of Named Scope for Cake on Codaset at <a href="http://codaset.com/joelmoss/cakephp-named-scope">http://codaset.com/joelmoss/cakephp-named-scope</a>.</p>




<p>And you know what? Thanks to the power of CakePHP, the actual code is seven lines shorter than the aforementioned version.</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Joel Moss</span></span>

      




<time datetime="2008-11-20 00:00:00 +0000" pubdate  updated >Nov 20<span>th</span>, 2008</time>



      

<span class="categories">
  
    <a class='category' href='/blog/categories/articles/'>articles</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://developwithstyle.com/blog/2008/11/20/namedscope-for-cakephp/" data-via="joelmoss" data-counturl="http://developwithstyle.com/blog/2008/11/20/namedscope-for-cakephp/" >Tweet</a>
  
  
</div>

    
  </footer>
</article>

</div>

<aside role=sidebar>
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/07/12/the-right-way-to-create-an-api/">The Right Way to Create an API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/10/28/from-zero-to-hero-how-i-built-twitious-in-two-weeks/">From Zero to Hero: How I built Twitious in Two Weeks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/08/09/dynamic-form-and-dynamic-errors-for-rails-3/">Dynamic Form and Dynamic Errors for Rails 3</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/07/09/handling-dates-in-mongodb/">Handling Dates in MongoDB</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/06/29/converting-html-entities-to-characters/">Converting HTML Entities to Characters with Javascript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/05/14/jquery-ui-autocomplete-is-it-any-good/">jQuery UI Autocomplete and Caching Query Results</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("joelmoss", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/joelmoss" class="twitter-follow-button" data-width="208px" data-show-count="true">Follow @joelmoss</a>
  
</section>




  
</aside>


    </div>
  </div>
  <footer><p>
  Copyright &copy; 2011 - Joel Moss -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
